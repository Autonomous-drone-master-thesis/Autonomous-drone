name: Pylint

on:
  push:
    branches:
      - main

jobs:
  pylint:
    name: Pylint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Install dependencies
        run: |
          pip install pylint pylint-json2html
        shell: bash
      - name: Run pylint
        run: |
          pylint --output-format=json ./**/*.py > pylint_report.json || true
          pylint_score=$(pylint --score y ./**/*.py || true)
          echo "::set-output name=pylint_score::$pylint_score"
          fi
        shell: bash
      - name: Convert Pylint output to HTML
        run: |
          pylint-json2html -f json -o pylint_report.html pylint_report.json
        shell: bash
      - name: Upload Pylint report as an artifact
        uses: actions/upload-artifact@v2
        with:
          name: Pylint report
          path: pylint_report.html
      - name: Dynamic Badges
        # You may pin to the exact commit or the version.
        # uses: Schneegans/dynamic-badges-action@5d424ad4060f866e4d1dab8f8da0456e6b1c4f56
        uses: Schneegans/dynamic-badges-action@v1.6.0
        with:
          auth: ${{ secrets.GIST_SECRET }}
          gistID: f75ffb077874ae17accb0f18037eef5d
          filename: badge.json
          label: Pylint
          message: pylint_score
          color: green
